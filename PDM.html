<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>360° Client</title>
<style>
    body {
      font-family: 'Georgia', serif;
      background-color: #f2f2f2;
      color: #00254d;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
    }

    .ipad-frame {
      background: black;
      width: 1366px;
      height: 1024px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 30px;
      padding: 20px;
    }

    .content {
      width: 90%;
      height: 90%;
      background: white;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }

    h2 {
      font-family: 'Times New Roman', Times, serif;
      color: #00254d;
      margin: 10px 0;
    }

    img.logo {
      max-width: 300px;
      height: auto;
      margin-bottom: 20px;
    }

    input[type="text"], textarea {
      width: 90%;
      max-width: 400px;
      padding: 10px;
      border: 1px solid #000000;
      border-radius: 4px;
      margin-bottom: 0;
      font-size: 16px;
      position: relative;
    }

    #suggestions {
      border: 1px solid #000000;
      background: #ffffff;
      color: #00254d;
      max-height: 300px;
      overflow-y: auto;
      width: 90%;
      max-width: 400px;
      box-sizing: border-box;
      margin-top: 10px;
      z-index: 1000;
    }

    #suggestions div {
      padding: 10px;
      cursor: pointer;
      border-bottom: 1px solid #000000;
    }

    #suggestions div:hover {
      background: #000000;
      color: #ffffff;
    }

    .details-comment-container {
      width: 100%;
      display: flex;
      justify-content: space-between;
      display: none;
    }

    #details-container, #comment-section {
      width: 48%;
    }

    #details-container {
      background: #ffffff;
      border: 1px solid #000000;
      padding: 20px;
      margin-top: 20px;
      border-radius: 8px;
    }

    #client-details h2 {
      color: #000000;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #transactions {
      margin-top: 20px;
      text-align: left;
    }

    .transaction-list {
      list-style-type: none;
      padding: 0;
    }

    .transaction-list li {
      border-bottom: 1px solid #000000;
      padding: 10px 0;
    }

    p {
      margin: 5px 0;
    }

    p strong {
      color: #00254d;
    }

    .editable {
      border: 1px solid #000000;
      border-radius: 4px;
      padding: 5px;
      width: 100%;
      box-sizing: border-box;
    }

    .edit-icon {
      top: 10px;
      right: 10px;
      width: 24px;
      height: 24px;
      cursor: pointer;
    }

    .pen-icon {
      cursor: pointer;
      width: 24px;
      height: 24px;
    }

    .non-editable {
      background-color: #f2f2f2;
      border: none;
      color: #00254d;
    }

    .pop-in {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #ffffff;
      border: 1px solid #000000;
      border-radius: 8px;
      width: 80%;
      max-width: 300px;
      z-index: 1000;
      text-align: center;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .pop-in h3 {
      font-family: 'Times New Roman', Times, serif;
      color: #00254d;
    }

    .pop-in button {
      margin: 10px;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }

    .pop-in .confirm {
      background-color: #000000;
      color: #ffffff;
    }

    .pop-in .cancel {
      background-color: #f2f2f2;
      color: #00254d;
    }

    .pop-in .confirm:hover {
      background-color: #00254d;
      color: #000000;
    }

    .pop-in .cancel:hover {
      background-color: #000000;
      color: #ffffff;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 500;
    }

    #comment-section {
      width: 48%;
      display: none;
      background: #ffffff;
      border: 1px solid #000000;
      padding: 20px;
      margin-top: 20px;
      border-radius: 8px;
    }

    #comment-section h2 {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #000000;
    }

    #comment-textarea {
      display: none;
      width: 100%;
    }

    #comment-section textarea {
      width: 100%;
      height: 100px;
    }

    #comment-section button {
      background-color: #000000;
      color: #ffffff;
      border: none;
      padding: 10px 20px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin-top: 10px;
      cursor: pointer;
      border-radius: 4px;
    }

    #comment-section button:hover {
      background-color: #00254d;
      color: #000000;
    }

    #save-button {
      background-color: #000000;
      color: #ffffff;
      border: none;
      padding: 10px 20px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin-top: 10px;
      cursor: pointer;
      border-radius: 4px;
      display: none; /* Masqué par défaut */
    }

    #save-button:hover {
      background-color: #00254d;
      color: #000000;
    }

    .add-contact {
      margin-left: 10px;
      background-color: #000000;
      color: #ffffff;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 24px;
      line-height: 40px;
      cursor: pointer;
    }

    .user-info {
      position: absolute;
      top: 20px;
      right: 20px;
      color: #00254d;
      font-size: 16px;
      background: #ffffff;
      padding: 10px;
      border-radius: 8px;
    }
    
    p {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

p input[type="text"] {
  flex: 1;
  margin-left: 40px;
}

/* CSS pour styliser le bouton Check-in */
.checkin-button {
  background-color: #000000; /* Couleur de fond dorée */
  color: #ffffff; /* Couleur du texte blanche */
  border: none; /* Pas de bordure */
  border-radius: 5px; /* Coins arrondis */
  padding: 10px 20px; /* Espacement interne (haut, droite, bas, gauche) */
  font-size: 16px; /* Taille de police */
  font-family: 'Georgia', serif; /* Police de caractères */  cursor: pointer; /* Curseur en forme de main au survol */
  transition: background-color 0.3s ease, color 0.3s ease; /* Transition pour les effets de survol */
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Ombre pour donner un effet de relief */
  margin-left: 20px; /* Marge gauche */
  margin-right: 20px; /* Marge droite */
  margin-top: 10px; /* Marge supérieure */
}

/* Effet de survol */
.checkin-button:hover {
  background-color: #00254d; /* Couleur de fond bleue foncée */
  color: #000000; /* Couleur du texte dorée */
}

/* Effet de clic */
.checkin-button:active {
  background-color: #001f3b; /* Couleur de fond encore plus foncée au clic */
  color: #f2f2f2; /* Couleur du texte plus claire au clic */
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Réduire l'ombre pour un effet de clic */
  transform: translateY(1px); /* Légère translation vers le bas pour effet de clic */
}
  </style>
<!-- MODIFIER URL IMAGE ICONE NAVIGATEUR -->
<link href="https://www.auberi.fr//img/m/9.jpg" rel="icon" type="image/gif"/>
</head>
<body>
<div class="ipad-frame">
<div class="content">
<div class="user-info">
<p style="margin-right: 10px; font-weight: bold;">Logged in as</p>
<p style="margin-right: 10px;">Linda BIRKLE</p>
<p style="margin-right: 10px;">MESSIKA HONORE</p>
</div>
<!-- MODIFIER URL IMAGE CENTRAL BARRE RECHERCHER -->
<img alt="Logo PDM" class="logo" src="https://www.auberi.fr//img/m/9.jpg"/>
<div style="display: flex; align-items: center;">
<input id="emailInput" placeholder="Enter email" type="text"/>
<button class="add-contact" id="add-contact-button">+</button>
</div>
<div id="suggestions"></div>
<div class="details-comment-container">
<div id="details-container">
<div id="client-details">
<h2>Client Details 
              <!-- NE PAS MODIFIER IMAGE - STYLO-->
<img alt="Edit" class="edit-icon" id="edit-icon" src="https://cdn-icons-png.flaticon.com/512/1250/1250615.png"/>
</h2>
<p><strong>First Name:</strong> <input class="editable non-editable" id="client-firstname" readonly="" type="text"/></p>
<p><strong>Last Name:</strong> <input class="editable non-editable" id="client-lastname" readonly="" type="text"/></p>
<p><strong>Email:</strong> <input class="editable non-editable" id="client-email" readonly="" type="text"/></p>

<p><strong>Telephone:</strong> <input class="editable non-editable" id="client-telephone" readonly="" type="text"/></p>
<p><strong>Opt-In Email:</strong> <input class="editable non-editable" id="client-optin" readonly="" type="text"/></p>
<!-- MODIFIER LABELS DES FAKE COLONNES-->
<p><strong>Status fidélité:</strong> <input class="editable non-editable" id="client-status" readonly="" type="text"/></p>
<p><strong>Date de naissance:</strong><input class="editable non-editable" id="client-seller" readonly="" type="text" value="27 avril 1996"/></p>
<p><strong>Classification client :</strong><input class="editable non-editable" id="client-RFM" readonly="" type="text"/></p>
<p><strong>Vendeur attitré : </strong><input class="editable non-editable" id="client-offre" readonly="" type="text" value="Linda BIRKLE"/></p>
<button id="save-button">Update contact details</button>
<div id="transactions">
<h2>Historique d'achat</h2>
<div>
<h3>Dernières Transactions magasin</h3>
<ul class="transaction-list" id="store-transactions"></ul>
</div>
<div>
<h3>Dernières Transaction web</h3>
<ul class="transaction-list" id="web-transactions"></ul>
</div>
</div>
</div>
</div>
<!-- Section de commentaires -->
<div id="comment-section">
<h2>Commentaires <img alt="Pen" class="pen-icon" id="pen-icon" src="https://cdn-icons-png.flaticon.com/512/1250/1250615.png"/></h2>
<div id="comment-textarea">
<textarea id="comment" placeholder="Enter your comment"></textarea>
<button id="submitCommentButton">Submit Comment</button>
</div><!-- Section Derniers Rendez-vous -->
<div id="appointments-section" style="display: none; width: 100%; margin-top: 20px;">
<h2 style="color: #000000;">Derniers Rendez-vous</h2>
<ul class="transaction-list" id="appointments-list"></ul>
</div>
<!-- Section Wishlist -->
<div id="wishlist-section" style="display: none; width: 100%; margin-top: 20px; text-align: center;">
<h2 style="color: #000000;">Produit souhaité</h2>
<div style="display: flex; justify-content: center; gap: 20px; margin-top: 10px;"><img src="Mathilde.jpg" href="https://www.messika.com/fr/bague-diamant-or-jaune-move-classique-04705-yg" style="max-width: 200px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);"/><a href="https://www.messika.com/fr/bague-diamant-or-jaune-move-classique-04705-yg" target="_blank"><img src="moveone.png" style="max-width: 200px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);"/></a></div></div>
</div>
</div>
</div>
</div>
<!-- Pop-in de confirmation -->
<div class="overlay" id="overlay"></div>
<div class="pop-in" id="confirmation-pop-in">
<h3>Confirm Changes</h3>
<p>Are you sure you want to save the changes?</p>
<button class="confirm" id="confirm-button">Confirm</button>
<button class="cancel" id="cancel-button">Cancel</button>
</div>
<!-- Pop-in de confirmation de soumission de commentaire -->
<div class="overlay" id="comment-overlay"></div>
<div class="pop-in" id="comment-confirmation-pop-in">
<h3>Submit Comment</h3>
<p>Are you sure you want to submit this comment?</p>
<button class="confirm" id="comment-confirm-button">Confirm</button>
<button class="cancel" id="comment-cancel-button">Cancel</button>
</div>
<!-- Pop-in de création de contact -->
  <!-- Pop-in de création de contact -->
  <div class="overlay" id="contact-overlay"></div>
  <div class="pop-in" id="contact-pop-in">
    <h3>Create New Contact</h3>
    <p>First Name: <input id="new-firstname" type="text"/></p>
    <p>Last Name: <input id="new-lastname" type="text"/></p>
    <p>Email: <input id="new-email" type="text"/></p>
    <!-- AJOUT DU CHAMP mobile -->
    <p>mobile: <input id="new-mobile" type="text"/></p>
    <button class="confirm" id="create-contact-button">Create</button>
    <button class="cancel" id="cancel-create-contact-button">Cancel</button>
  </div>

<!-- Pop-in de confirmation de Check-in -->
<div class="overlay" id="checkin-popin-overlay"></div>
<div class="pop-in" id="checkin-popin">
<h3>Confirmer Check-in</h3>
<p>Êtes-vous sûr de vouloir faire le check-in ?</p>
<button class="confirm" id="confirm-checkin-button">Oui</button>
<button class="cancel" id="cancel-checkin-button">Non</button>
</div>

<script>
/* === Configuration === */
const proxyBase = "https://rough-cloud-09a3.francois-imagino.workers.dev/proxy";
let allClients = []; // cache de tous les profils

/* === Chargement des contacts en masse une seule fois === */
async function loadAllClients() {
  if (allClients.length) return allClients; // déjà chargé
  try {
    const url = `${proxyBase}/ucdapi/Vue_client_360/V3/sCVDEMO`;
    const resp = await fetch(url, {
      method: "GET",
      headers: { "Content-Type": "application/json" }
    });
    const data = await resp.json();
    allClients = data && data.data ? data.data : [];
  } catch (err) {
    console.error("Erreur chargement contacts :", err);
  }
  return allClients;
}

/* === Filtre local insensible à la casse === */
function filterClients(term) {
  const s = term.toLowerCase();
  return allClients.filter(c =>
    (c.firstName && c.firstName.toLowerCase().includes(s)) ||
    (c.lastName && c.lastName.toLowerCase().includes(s)) ||
    (c.email && c.email.toLowerCase().includes(s))
  );
}

/* === Utils UI === */
function clearSuggestions() {
  document.getElementById('suggestions').innerHTML = '';
}

function showHideDetails(show) {
  document.querySelector('.details-comment-container').style.display = show ? 'flex' : 'none';
}

/* === Affichage suggestions === */
function displaySuggestions(records) {
  const suggestions = document.getElementById('suggestions');
  suggestions.innerHTML = '';
  records.slice(0, 15).forEach(record => {
    const div = document.createElement('div');
    div.textContent = `${record.firstName} ${record.lastName} - ${record.email}`;
    div.addEventListener('click', () => {
      fetchClientDetails(record.email);
      document.getElementById('emailInput').value = record.email;
      clearSuggestions();
    });
    suggestions.appendChild(div);
  });
}

/* === Recherche temps réel === */
document.getElementById('emailInput').addEventListener('input', async function () {
  const term = this.value.trim();
  if (!term) {
    clearSuggestions();
    showHideDetails(false);
    return;
  }
  await loadAllClients();
  const matches = filterClients(term);
  if (matches.length) {
    displaySuggestions(matches);
  } else {
    clearSuggestions();
    showHideDetails(false);
  }
});

/* === Récupération détails d'un client unique (transactions, etc.) === */
async function fetchClientDetails(email) {
  try {
    const url = `${proxyBase}/ucdapi/Vue_client_360/V3/sCVDEMO?exact_email=${encodeURIComponent(email)}`;
    const response = await fetch(url, {
      method: "GET",
      headers: { "Content-Type": "application/json" }
    });
    const data = await response.json();
    processClientDetails(data);
  } catch (err) {
    console.error("Erreur fetch détails :", err);
    showHideDetails(false);
  }
}

/* === Le reste de tes fonctions (processClientDetails, enableEditing, etc.) restent inchangées === */
/* ... Pour gagner de la place, on insère ici l'intégralité des fonctions existantes non modifiées ... */

/* === COLLER ICI le reste de ton ancien script à partir de processClientDetails(...) === */
</script>

</body>
</html>
